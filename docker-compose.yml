version: '3.8'

services:
  app:
    image: ${DOCKER_IMAGE:-deployment-dashboard}:${APP_VERSION:-latest}
    container_name: dashboard-app
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - APP_VERSION=${APP_VERSION:-v2.4.1}
      - BUILD_NUMBER=${BUILD_NUMBER:-0}
      - BUILD_DATE=${BUILD_DATE:-}
      - GIT_BRANCH=${GIT_BRANCH:-main}
      - GIT_COMMIT=${GIT_COMMIT:-unknown}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:3000/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
